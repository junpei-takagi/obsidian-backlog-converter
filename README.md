# Backlog Markdown Converter for Obsidian

ObsidianでMarkdownファイルをBacklog記法に変換、またはBacklog記法から標準Markdownに変換するプラグインです。

## 機能

### 主要機能
- **MarkdownからBacklog記法への変換**: 標準MarkdownをBacklog独自の記法に変換
- **Backlog記法からMarkdownへの変換**: Backlog記法を標準Markdownに逆変換
- **プレビュー機能**: 変換前後の内容を確認してから適用
- **カスタムルール**: 独自の変換ルールを設定可能
- **リボンアイコン**: サイドバーから簡単にアクセス
- **ステータスバーボタン**: 下部ステータスバーからワンクリック変換
- **クイック変換モーダル**: 直感的な変換操作

### 変換対象

#### MarkdownからBacklog記法
| 変換前（Markdown） | 変換後（Backlog記法） | 説明 |
|---|---|---|
| `# 見出し1` | `* 見出し1` | 見出しレベルに応じて*の数が変わる |
| `**太字**` | `''太字''` | 太字を二重クォートに変換 |
| `*斜体*` | `'''斜体'''` | 斜体を三重クォートに変換 |
| `~~打ち消し~~` | `%%打ち消し%%` | 打ち消し線をパーセント記号に変換 |
| `- リスト項目` | `- リスト項目` | リストは階層レベルに応じてダッシュの数が変わる |
| `1. 番号付きリスト` | `+ 番号付きリスト` | 番号付きリストをプラス記号に変換 |
| `` ```code``` `` | `{code}code{/code}` | コードブロックをBacklog記法に変換 |
| `[リンク](URL)` | `[[リンク>URL]]` | リンクをBacklog記法に変換 |
| `![画像](URL)` | `#image(URL)` | 画像をBacklog記法に変換 |
| `**重要**` | `&color(red) { 重要 }` | 重要語句を赤色テキストに |
| `**成功**` | `&color(green) { 成功 }` | 成功語句を緑色テキストに |
| `**情報**` | `&color(blue) { 情報 }` | 情報語句を青色テキストに |

#### Backlog記法からMarkdown
| 変換前（Backlog記法） | 変換後（Markdown） | 説明 |
|---|---|---|
| `* 見出し1` | `# 見出し1` | 見出しレベルに応じて#の数が変わる |
| `''太字''` | `**太字**` | 二重クォートを太字に変換 |
| `'''斜体'''` | `*斜体*` | 三重クォートを斜体に変換 |
| `%%打ち消し%%` | `~~打ち消し~~` | パーセント記号を打ち消し線に変換 |
| `- リスト項目` | `- リスト項目` | 階層レベルに応じてインデント付きリストに変換 |
| `+ 番号付きリスト` | `1. 番号付きリスト` | プラス記号を番号付きリストに変換 |
| `{code}code{/code}` | `` ```code``` `` | コードブロックをMarkdown記法に変換 |
| `[[リンク>URL]]` | `[リンク](URL)` | Backlogリンクを標準Markdownリンクに変換 |
| `#image(URL)` | `![](URL)` | 画像をMarkdown記法に変換 |
| `&color(red) { 重要 }` | `**重要**` | 色付きテキストを強調テキストに |
| `{quote}引用{/quote}` | `> 引用` | 引用ブロックをMarkdown記法に変換 |
| `#contents` | `[TOC]` | 目次をMarkdown記法に変換 |

## インストール

### 手動インストール

#### 方法1: リリース版を使用（推奨）
1. [Releases](../../releases)から最新の`obsidian-backlog-converter-x.x.x.zip`をダウンロード
2. ZIPファイルを解凍
3. 解凍したフォルダを以下の場所にコピー：
   ```
   {Obsidianのボルト}/.obsidian/plugins/
   ```
   最終的なディレクトリ構造：
   ```
   .obsidian/plugins/backlog-converter/
   ├── main.js
   ├── manifest.json
   ├── styles.css
   └── README.md
   ```
4. Obsidianを再起動
5. 設定 → コミュニティプラグイン → "Backlog Markdown Converter"を有効化

#### 方法2: ソースからビルド
1. 本リポジトリをクローン
   ```bash
   git clone [repository-url]
   cd obsidian-backlog-converter
   ```
2. 依存関係をインストールしてビルド
   ```bash
   npm install
   npm run release
   ```
3. `release/obsidian-backlog-converter/`フォルダを`.obsidian/plugins/backlog-converter/`にコピー
4. Obsidianを再起動してプラグインを有効化

### 開発環境でのビルド
```bash
npm install
npm run dev
```

### リリース版のビルド
```bash
npm install
npm run release
```

このコマンドを実行すると：
- `release/obsidian-backlog-converter/` フォルダにプラグインファイルが作成される
- `release/obsidian-backlog-converter-{version}.zip` にZIPパッケージが作成される
- ZIPファイルを解凍して `.obsidian/plugins/` にコピーするだけでインストール完了

## 使用方法

### 1. 基本設定
1. 設定 → プラグインオプション → "Backlog Markdown Converter"
2. 以下の情報を設定：
   - **Backlog Base URL**: BacklogのベースURL（例：`https://yourproject.backlog.jp`）
   - **Project Key**: プロジェクトキー（例：`MYPRJ`）
   - **自動変換を有効にする**: ファイル保存時の自動変換（実験的機能）
   - **タブインデントを使用**: リストの階層表現にタブインデントを使用（オフの場合は2スペース）

### 2. 変換の実行

#### リボンアイコンから実行（推奨）
1. 左サイドバーの太字アイコン（Backlog変換）をクリック
2. 表示されるメニューから変換方向を選択：
   - **Markdown → Backlog記法に変換**
   - **Backlog記法 → Markdownに変換**
   - **変換プレビュー**
   - **設定を開く**

#### ステータスバーから実行
1. 下部ステータスバーの「Backlog変換」ボタンをクリック
2. クイック変換モーダルで変換方向を選択

#### コマンドパレットから実行
1. `Ctrl+P`（Mac: `Cmd+P`）でコマンドパレットを開く
2. 以下のコマンドから選択：
   - `Markdown → Backlog記法に変換`: MarkdownからBacklog記法に変換
   - `Backlog記法から標準Markdownに変換`: 逆変換
   - `Backlog変換のプレビュー`: 変換前後の内容を確認

#### ショートカットキー
設定 → ホットキー で各コマンドにショートカットキーを割り当て可能

### 3. カスタムルールの設定
独自の変換ルールを追加できます：

1. プラグイン設定を開く
2. "カスタム変換ルール"セクション
3. "ルール追加"ボタンをクリック
4. 正規表現パターンと置換文字列を入力

**例**:
- パターン: `\\[TODO\\]`
- 置換: `&color(orange) { TODO }`

## 注意事項

### バックアップ
- 変換を実行する前に、重要なファイルのバックアップを取ることを強く推奨します
- Git等のバージョン管理システムの使用を推奨します

### 制限事項
- 複雑な表やネストした構造では正しく変換されない場合があります
- カスタムルールでは正規表現の知識が必要です
- 一部のBacklog独自機能（添付ファイル参照等）は対応していません

### パフォーマンス
- 大きなファイル（10MB以上）では変換に時間がかかる場合があります
- 多数のカスタムルールは変換速度に影響する可能性があります

## トラブルシューティング

### よくある問題

**Q: 変換後の内容が期待と異なる**
A: カスタムルールの正規表現パターンを確認してください。無効なパターンはコンソールに警告が表示されます。

**Q: プラグインが動作しない**
A: 以下を確認してください：
- Obsidianのバージョンが0.15.0以上
- プラグインが有効化されている
- コンソール（F12）にエラーメッセージがないか

**Q: 課題URLの変換が機能しない**
A: 設定でBacklog Base URLとProject Keyが正しく設定されているか確認してください。

**Q: リストの階層表示が正しくない**
A: 設定でタブインデントの使用方法を確認してください。Markdownファイルのインデント方式（タブまたはスペース）と設定を合わせる必要があります。

**Q: プレビューで文字化けやスタイルが崩れる**
A: Obsidianのテーマ設定を確認してください。プラグインはライト/ダークテーマの両方に対応しています。

## 開発

### 開発環境の構築
```bash
git clone <repository-url>
cd obsidian-backlog-converter
npm install
```

### ビルド
```bash
npm run build
```

### 開発モード
```bash
npm run dev
```

### コントリビューション
プルリクエストやイシューの報告を歓迎します。

## 技術仕様

### サポートされるBacklog記法要素
- **見出し**: `*` `**` `***` `****` `*****` `******` (最大6レベル)
- **テキスト装飾**: 太字(`''text''`)、斜体(`'''text'''`)、打ち消し線(`%%text%%`)
- **リスト**: 箇条書き(`-` `--` `---`)、番号付き(`+`)
- **リンク**: `[[text>URL]]` または `[[text:URL]]`
- **画像**: `#image(URL)`
- **コードブロック**: `{code}code{/code}`
- **引用**: `{quote}text{/quote}`
- **色指定**: `&color(red|green|blue) { text }`
- **課題参照**: プロジェクトキー設定時の自動変換
- **目次**: `#contents`

### 変換ルールの詳細
プラグインは正規表現ベースの変換ルールを使用し、以下の順序で処理を行います：
1. 見出しの変換（他のルールとの競合を避けるため最初に処理）
2. テキスト装飾（太字→斜体の順序で処理）
3. リスト項目（インデントレベルの自動検出）
4. リンクと画像
5. コードブロック
6. 特殊要素（色指定、引用など）
7. カスタムルール

## 更新履歴

### v1.0.0
- 初回リリース
- 基本的な変換機能（Markdown ⇄ Backlog記法）
- リアルタイムプレビュー機能
- カスタム変換ルール機能
- 詳細な設定画面
- リボンアイコンとステータスバーからのアクセス
- クイック変換モーダル
- タブ/スペースインデント設定
- 階層リスト対応（最大6レベル）
- 豊富なスタイリング（ダークテーマ対応）

## ライセンス

このプロジェクトは [MIT License](LICENSE) の下で公開されています。
